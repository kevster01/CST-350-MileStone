@model CST350_Milestone1.Models.Board;

@{
    ViewData["Title"] = "Game";
}

@{
    int rowInput = 0;
    int colInput = 0;
}

@functions {

}

<h1>Minesweeper</h1>

<hr />

<div class="container" style="margin-bottom: 4rem;">
    <form method="post" asp-area="" asp-controller="Game" asp-action="UpdateCell" class="container">
        <input type="hidden" value=@rowInput />
        <input type="hidden" value=@colInput />

        <div class="game-board">
            @for (int row = 0; row < Model.Grid.GetLength(0); row++)
            {
                <div class="row d-flex justify-content-center align-items-center pr-2 pl-2 pt-3">
                    @for (int col = 0; col < Model.Grid.GetLength(1); col++)
                    {
                        var cell = Model.Grid[row, col];
                        <div style="height:40px;width:40px;padding:0;margin-right:6px;margin-left:6px;">
                            @if (cell.Visited)
                            {
                                if (cell.Live)
                                {
                                    <button type="button" class="btn btn-danger" style="width:100%;height:100%;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-emoji-dizzy-fill" viewBox="0 0 16 16">
                                            <path d="..."></path>
                                        </svg>
                                    </button>
                                }
                                else if (cell.LiveNeighbors > 0)
                                {
                                    <button type="button" class="btn btn-secondary" style="width:100%;height:100%;">
                                        <span>@cell.LiveNeighbors</span>
                                    </button>
                                }
                                else
                                {
                                    <button type="button" class="btn btn-secondary" style="width:100%;height:100%;"></button>
                                }
                            }
                            else if (cell.Flagged)
                            {
                                <button type="button" class="btn btn-secondary" style="width:100%;height:100%;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
                                        <path d="..."></path>
                                    </svg>
                                </button>
                            }
                            else
                            {
                                <button class="btn btn-secondary" style="width:100%;height:100%;" onclick="updateCell(@row, @col);">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-question" viewBox="0 0 16 16">
                                        <path d="..."></path>
                                    </svg>
                                </button>
                            }
                        </div>
                    }
                </div>
            }
        </div>
    </form>
</div>

<div>
    <a asp-action="Index">Back to Home</a>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="~/js/game.js"></script>
    <script>
        function updateCell(row, cell) {
            $.ajax({
                type: "POST",
                url: "@Url.Action("UpdateCell", "Game")", // Generate the URL for the action
                data: {
                    row: row,
                    cell: cell
                },
                success: function (data) {
                    $("#game-board").html(data);
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                }
            });
        }
    </script>
}

